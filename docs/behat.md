Behat cheat sheet
===================

Version (in this tutorial) : 3.11.0

:link: [Official current documentation](https://behat.org/en/latest/guides.html)

Principles
----------
**BDD - Behavior Driven Development**
- Write the behavior for a feature list
- **Code until the behavioral tests passes**
- Think first & then code => maximize the value

**2 types of BDD**
1. Story : is done wih `Behat` & `functional tests` (can be done with PHPUnit `WebTestCase` & `KernelTestCase`  :tada:)
2. Spec : is done with `PHPSpec` & `Unit tests` (can be done with PHPUnit `kernelTestCase` :tada:)

**BDD steps**
1. Define the business value of all of the big feature.
2. Prioritize your features.
3. Take one feature and break it down into user stories or scenarios.
4. Write the code for the feature

Getting started
---------------
1. Install the dependency if it's not present in symfony the project by using : `composer require friends-of-behat/mink-extension friends-of-behat/mink-browserkit-driver friends-of-behat/symfony-extension --dev` 
   or to use `Goutte` (make real HTTP requests) :
   `composer require friends-of-behat/mink-extension friends-of-behat/mink-browserkit-driver behat/mink-goutte-driver --dev`
2. Check the install by : 
   1. Go in the PHP container within : `make bash`
   2. and the running : `./vendor/bin/behat -V`

:bulb: Run Behat tests using `make behat-tests` or `make behat-test [path]`.

Adding tests
------------
1. Create as many files as there are features in the `features/` directory using the Gherkin convention (`feature_name.feature`).
2. Add for each feature a description (**not parsed and not executed, only to understand the feature**)
3. Add scenario(s) for each of them
4. Update content in function of the `Context.php` file(s) that are defined in the `behat.yml.dist` file.:bulb: Behat's autogenerated snippets can help!

:warning: Don't forget to always respect the template (see below)!  

**Feature's template (according to Gherkin):**
```gherkin
Feature: User story title
In order to ... (focus business value)
As ... (who?)
I need/ I want ...

[Additional notes] : functional rules or complements (TVA, rates...)

Scenario: Some description of the scenario
Given some context
When some event
Then outcome
(And another outcome)
(But another outcome)
```
> :warning:  Thereâ€™s no actual difference between, `Then`, `And`, `But` or any of the other words that start each line. These keywords are all made available so that your scenarios are natural and readable.

:bulb: Pattern : `Context - Action - Outcome`

Pro tips
--------
1. **Use tags**
   - Prefixed by "@" and often before a scenario like that :
      ```gherkin
      ...      
      @tagName
      Scenario: Some description of the scenario
      ```
   - Useful for automate actions (refresh DB, statistics...)
2. **Meaningful titles**
   - concise
   - evident
   - title to describe the objective of the requirement and the test result
   - example of a good one:
      ```gherkin
      Feature: User access
      Scenario: When the user logs out the app shown a login prompt
      ```
3. **One test per scenario**
   - The shorter it is, the more the system will be adopted by the stakeholders.
4. **User focus wording**
   - Understandable by all stakeholders (engineers, managers, UX, UI, PO...)
   - Short
   - Check the previous tips!
5. **Automation-friendly tests**
   - Use tools : 
     - **Hooks** (`@Before`, `@After`, `@Suite`, `@Feature` & `@Scenario`)
     - **Transform**
     - **Panther** using [robertfausk/behat-panther-extension](https://github.com/robertfausk/behat-panther-extension)

Credits
-------
- [Behat official documentation](https://behat.org/en/latest/index.html)
- [Behat screencast by SymfonyCasts](https://symfonycasts.com/screencast/behat)
- ["What's in a Story" (about BDD philosophy)](https://dannorth.net/whats-in-a-story/)
- [Behat Panther Extension (symfony/panther extension)](https://github.com/robertfausk/behat-panther-extension)
- [Tips from Bluefruit Software](https://www.bluefruit.co.uk/quality/gherkin-bdd)